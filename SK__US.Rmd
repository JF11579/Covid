---
title: "SK_US_tests_v_deaths"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Link to GoogDrive did not work.
```{r}
library(googledrive)
```
#https://googledrive.tidyverse.org/

```{r}
library(tidyverse)
library(ggplot2)
library(lubridate)

```

```{r}
options(scipen = 999)
```


```{r}
#drive_find( pattern = "covid-tests-cases-deaths")
```

# data  https://drive.google.com/open?id=1AWZ8TKpnka7Mn3kjHSo3Rjf9Su3RTSJY


```{r}
data<- read_csv("covid_tests.csv")
```

```{r}
dim(data)
```

```{r}
str(data)
```

```{r}
View(covid_deaths)
```



```{r}
US<- filter(data,Code == "States")
```

```{r}
dim(US)
```
```{r}
head(US)
```


```{r}
#data_2<- bind_rows(US, SK)
```

```{r}
#drop any irrelevant rows like Virgin Isles
US_SK_tests<- data%>%
      filter(Date %in% c("KOR", "USA"))
```

```{r}
View(US_SK_tests)
```


```{r}
write_csv(US_SK_tests, "US_SK_tests.csv")
```

```{r}
str(data_3)
```
######################################################################
######### Next repeat the proces with covid death stats ###############


```{r}
covid_deaths<- read_csv("covid_daily_deaths.csv")
```

```{r}
View(covid_deaths)
```

```{r}
US_deaths<- filter(covid_deaths,Code == "USA")
```

```{r}
View(US_deaths)
```
```{r}
str(US_deaths)
```

```{r}
head(US_deaths,2)
```


```{r}
#Change col names
#rename(new name = existing)
US_deaths<- US_deaths %>%
            rename(Country = Entity ,Deaths = `Daily confirmed deaths (deaths)`)
```

```{r}
head(US_deaths)
```

```{r}
US_deaths$Country<- as.factor(US_deaths$Country)
```

```{r}
#Convert to date type.convert()
#US_SK_tests$Date<- mdy(US_SK_tests$Date)
US_deaths$Date <- mdy(US_deaths$Date)
```


```{r}
US_deaths$Deaths<- as.numeric(US_deaths$Deaths)
```

```{r}
str(US_deaths)
```

```{r}
head(US_deaths)
```


```{r}
#next group by month
US_deaths<-US_deaths %>%
    group_by(month=floor_date(Date,"month")) %>%
    summarise(tot_deaths=sum(Deaths))
US_deaths
```


```{r}
 head(US_deaths)
```

```{r}
#Add country data back in
#X$x1<- 'SouthKorea'
US_deaths$Country <- "USA"


```

```{r}
head(US_deaths)
```

#Next SK deaths


```{r}
#Change col names
#rename(new name = existing)
#US_deaths<- US_deaths %>%
            #rename(Country = Entity ,Deaths = `Daily confirmed deaths (deaths)`)
SK_deaths<-SK_deaths %>%
            rename(Country= Entity, Deaths = `Daily confirmed deaths (deaths)`)
```

```{r}
SK_deaths$Country <- as.factor(SK_deaths$Country)
```

```{r}
#US_deaths$Date <- mdy(US_deaths$Date)
SK_deaths$Date <- mdy(SK_deaths$Date)
```


```{r}
head(SK_deaths,2)
```

```{r}
#US_deaths<- filter(covid_deaths,Code == "USA")
SK_deaths<- filter(covid_deaths,Entity =="South Korea")
```

```{r}
head(SK_deaths)
```

X<- US_SK_deaths %>%
    group_by(month=floor_date(Date,"month")) %>%
    summarise(tot_deaths=sum(deaths))
```{r}
#next get monthly sums
SK_deaths<- SK_deaths %>%
    group_by(month=floor_date(Date,"month")) %>%
    summarise(tot_deaths=sum(Deaths))
SK_deaths
```

```{r}
#now restore country name
#X$x1<- 'SouthKorea'
SK_deaths$Country <- 'South Korea'
```

```{r}
head(SK_deaths,2)
```

#Next rowbind the US & SK deaths
```{r}
A<- rbind(US_deaths, SK_deaths)
```

# Now try bar plotting

```{r}
B2<-  ggplot(A,
            aes(x=month, y= tot_deaths, color = factor(Country)))+
            geom_col(aes(color = Country, fill = Country), position = position_dodge(10), width = 1) +
  ggtitle("Deaths")+
  scale_y_log10()
B2
```
 scale_y_continuous(breaks = c( 0,9000000,10000000,100000000,200000000,300000000))+
 
  theme(axis.title.x = element_blank(),
          axis.title.y = element_blank())+
theme( # remove the vertical grid lines
           panel.grid.major.x = element_blank() ,
           # explicitly set the horizontal lines (or they will disappear too)
           panel.grid.major.y = element_line( size=.1, color="black" ) 
```{r}
B3<-  ggplot(A,
            aes(x=month, y= tot_deaths, color = factor(Country)))+
            geom_col(aes(color = Country, fill = Country, width=20), position = position_dodge(20), width = 0.1) +
  ggtitle("Deaths")+
  scale_y_sqrt()+
   scale_y_continuous(breaks = c( 100,200000,400000,600000))+
  labs(x="", y="Deaths") +
  theme_classic()
  
  
B3
```
 



















#########3
##############
############
```{r}
SK_deaths<- filter(covid_deaths,Code == "KOR")
```

```{r}
View(SK_deaths)
```

```{r}
#now combine US_SK death data.
#US_SK_deaths<- bind_rows(US_deaths, SK_deaths)
```

```{r}
View(US_SK_deaths)
```

```{r}
write_csv(US_SK_deaths,"US_SK_deaths.csv")
```

########## import cleaned up data ##########

```{r}
US_SK_tests<- read_csv("US_SK_tests.csv")
```

```{r}
str(US_SK_tests)
```

```{r}
US_SK_tests$Country<- as.factor(US_SK_tests$Country)
```



```{r}
US_SK_tests$Date<- mdy(US_SK_tests$Date)
```

```{r}
head(US_SK_tests)
```

```{r}
B<- US_SK_tests%>%
      group_by(Date, "month") %>%
      mutate(total_test= cumsum(tests))
B
```



```{r}
US_SK_deaths<- read_csv("US_SK_deaths.csv")
```

```{r}
US_SK_deaths$Country<- as.factor(US_SK_deaths$Country)
```


```{r}
US_SK_deaths$Date<- mdy(US_SK_deaths$Date)
```

```{r}
head(US_SK_deaths,3)
```

```{r}
A<-US_SK_deaths_2<- US_SK_deaths %>%
mutate(month = format(Date, "%m"), year = format(Date, "%Y")) %>%
group_by(month, year) %>%
summarise(total = sum(deaths))
```

```{r}
A
```


######## Line Graph Tests

```{r}
L1<- ggplot(US_SK_tests,
            aes(x=Date,y= tests, color= factor(Country)))+
              geom_line()+
  ggtitle("Tests")+
  theme_classic()
L1
```



################ Layered Plots #####################

```{r}
 ggplot(A,
            aes(x=month, y= tot_deaths, color = factor(Country)))+
            geom_col(aes(color = Country, fill = Country, width=20), position = position_dodge(20), width = 0.1) +
  ggtitle("Deaths")+
  scale_y_sqrt()+
   scale_y_continuous(breaks = c( 100,200000,400000,600000))+
  labs(x="", y="Deaths") +
  theme_classic()+
  geom_label()+
  deom_line
  
  

```
























########### Bar Graph for Deaths


```{r}
# graph by month:
ggplot(US_SK_deaths = log,
  aes(Date, Deaths)) +
  stat_summary(fun.y = sum, # adds up all observations for the month
    geom = "bar") + # or "line"
  scale_x_date(
    labels = date_format("%Y-%m-%d"),
    breaks = "1 month")
```

```{r}
B1<- ggplot(US_SK_deaths,
            aes(x=Date, y= deaths, color = factor(Country)))+
            geom_col(aes(color=Country,fill=Country))+
  ggtitle("Deaths")
B1
```


############### junk ############

```{r}
(expenses <- data_frame(
  date=seq(as.Date("2016-01-01"), as.Date("2016-12-31"), by=1),
  amount=rgamma(length(date), shape = 2, scale = 20)))
```


```{r}
expenses %>% group_by(month=floor_date(date, "month")) %>%
   summarize(amount=sum(amount))

```


```{r}
str(US_SK_deaths)
```

```{r}
X<- US_SK_deaths %>%
    group_by(month=floor_date(Date,"month")) %>%
    summarise(tot_deaths=sum(deaths))
X
```

```{r}
X$x1<- 'SouthKorea'
```

```{r}
head(X)
```
#example
```{r}
df1 <- data.frame(p=c(10,8,7,3,2,6,7,8),
             v=c(100,300,150,400,450,250,150,400))
```

```{r}
df2 <- data.frame(p=c(10,8,6,4), v=c(150,250,350,400))
```

```{r}
plot1 <- qplot(df1$v, df1$p)
plot1
```

```{r}
plot2 <- qplot(df2$v, df2$p, geom="step")
plot2
```

```{r}
plot3 <- ggplot(df1, aes(v, p)) + geom_point()
plot3
```
```{r}
plot4 <- ggplot(df2, aes(v, p)) + geom_step()
plot4
```

```{r}
#df1 is the default dataset for all geoms
(plot1 <- ggplot(df1, aes(v, p)) + 
    geom_point() +
    geom_step(data = df2)
)
```

```{r}
#No default; data explicitly specified for each geom
(plot2 <- ggplot(NULL, aes(v, p)) + 
      geom_point(data = df1) +
      geom_step(data = df2)
)
```


#https://stackoverflow.com/questions/9109156/ggplot-combining-two-plots-from-different-data-frames
```{r}
ggplot() + 
geom_line(data=df1, aes(x=A, y=B), color='green') + 
geom_line(data=df2, aes(x=C, y=D), color='red')
```

